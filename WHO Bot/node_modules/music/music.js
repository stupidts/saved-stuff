const ytdl = require('ytdl-core');

module.exports.run = async (bot, message, args) => {
  void Play(song)
  {
    console.log('Recieved song request');
    if (!message.member.voiceChannel/* || message.author.voiceChannel.id !== 457390433446920193*/) return message.channel.send(`Please connect to the <#457390433446920193> voice channel.`);

    //if (message.guild.me.voiceChannel) return message.channel.send('WHO? Bot is already in a channel.');

    if (!song) return message.channel.send('Input a proper url.');

    let validate = await ytdl.validateURL(song);

    if (!validate) return message.channel.send('Input a proper url.');

    let info = await ytdl.getInfo(song);

    let connection = await message.member.voiceChannel.join();

    let dispatcher = await connection.playStream(ytdl(song, { filter: 'audioonly'}));

    let time = '';
    let n = info.length_seconds
    var day = Math.floor(n / (24 * 3600));
  	n = n % (24 * 3600);
    console.log(day + 'd');
  	var hour = Math.floor(n / 3600);
  	n %= 3600;
    console.log(hour + 'h');
  	var minute = Math.floor(n / 60);
  	n %= 60;
    console.log(minute + 'm');
  	var second = Math.floor(n);
    console.log(second + 's');
    if (minute < 1 && hour < 1 && day < 1) {time = (second + 's').toString();}
    else if (hour < 1 && day < 1) {time = (minute + 'm ' + second + 's').toString();}
    else if (day < 1) {time = (hour + 'h ' + minute + 'm ' + second + 's').toString();}
    else {time = (day + 'd ' + hour + 'h ' + minute + 'm ' + second + 's').toString();}

    message.channel.send(`Now playing: ${info.title} - ${time}`);
    let songInfo = (info.title + ' - ' + time).toString();
    let nameChannel = bot.channels.get('457363887822733313').setName(songInfo);

  }
  void Stop()
  {
    message.member.voiceChannel.leave();
  }
}
module.exports = music;
